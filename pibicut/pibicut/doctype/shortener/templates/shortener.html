<html>
  <script type="text/javascript">
    async function incrementAndRedirect(name, longUrl) {
      try {
        // Construct the query string for the GET request
        const queryString = new URLSearchParams({ name: name }).toString();
        const apiEndpoint = `/api/method/pibicut.pibicut.doctype.shortener.shortener.increment_redirect?${queryString}`;

        // Make the GET request to increment the redirect count
        let response = await fetch(apiEndpoint, { method: 'GET' });

        // Proceed with redirection regardless of the API response
        window.location.replace(longUrl);
      } catch (error) {
        console.error("Error incrementing redirect count:", error);
        // Proceed with redirection in case of error
        window.location.replace(longUrl);
      }
    }

    // Start redirection after incrementing the counter
    incrementAndRedirect("{{ name }}", "{{ long_url }}");
  </script>
</html>
<body>
  <div>
    <span>
      <p>Redirecting to</p>
      <a href='{{ long_url }}' style="color:#4682b4;">{{ long_url }}</a>
    </span>
  </div>
</body>